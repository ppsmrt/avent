<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Avanta - Profile</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
 
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script type="module">
  import { loadHeader } from './js/header.js';
  loadHeader('profile');
</script>

<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #f0f2f5, #d9e2ec);
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    min-height: 100vh;
  }

  .wrapper {
    width: 100%;
    max-width: 420px;
    padding: 15px;
    box-sizing: border-box;
  }

  /* Profile Card */
  .profile-card {
    background: white;
    padding: 20px;
    text-align: center;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    margin-bottom: 15px;
  }

  .profile-img {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 10px;
    border: 4px solid #fff;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }

  .profile-name {
    font-size: 1.4em;
    font-weight: bold;
    margin: 5px 0;
  }

  .profile-designation {
    font-size: 1em;
    color: gray;
  }

  /* Details Card */
  .details-card {
    background: white;
    padding: 10px;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    margin-bottom: 15px;
  }

  .detail-row {
    display: flex;
    align-items: center;
    padding: 12px 5px;
    border-bottom: 1px solid #f0f0f0;
    gap: 12px;
  }

  .detail-row:last-child {
    border-bottom: none;
  }

  .detail-row i {
    font-size: 20px;
    min-width: 28px;
    text-align: center;
  }

  .detail-row input {
    flex: 1;
    border: none;
    background: transparent;
    outline: none;
    font-size: 15px;
    color: #333;
  }

  /* Colored Icons */
  .icon-name { color: #007bff; }
  .icon-designation { color: #28a745; }
  .icon-dob { color: #ff9800; }
  .icon-address { color: #9c27b0; }
  .icon-phone { color: #17a2b8; }
  .icon-id { color: #6c757d; }
  .icon-blood { color: #e91e63; }

  /* Update Button */
  #updateBtn {
    width: 100%;
    background: linear-gradient(90deg, #007bff, #0056b3);
    color: white;
    padding: 14px;
    font-size: 16px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    transition: background 0.3s ease;
  }

  #updateBtn:hover {
    background: linear-gradient(90deg, #0056b3, #003f88);
  }
</style>
</head>
<body>

<div class="wrapper">
  <!-- Profile Card -->
  <div class="profile-card">
    <img id="profilePic" class="profile-img" src="https://tamilgeo.wordpress.com/wp-content/uploads/2025/08/images4526844530498709058.png" alt="Profile Picture">
    <div class="profile-name" id="empNameDisplay">—</div>
    <div class="profile-designation" id="empDesignationDisplay">—</div>
  </div>

  <!-- Details Card -->
  <div class="details-card">
    <div class="detail-row">
      <i class="fa fa-user icon-name"></i>
      <input type="text" id="empName" readonly>
    </div>
    <div class="detail-row">
      <i class="fa fa-briefcase icon-designation"></i>
      <input type="text" id="empDesignation" readonly>
    </div>
    <div class="detail-row">
      <i class="fa fa-birthday-cake icon-dob"></i>
      <input type="text" id="empDOB" readonly>
    </div>
    <div class="detail-row">
      <i class="fa fa-home icon-address"></i>
      <input type="text" id="empAddress" readonly>
    </div>
    <div class="detail-row">
      <i class="fa fa-phone-alt icon-phone"></i>
      <input type="text" id="empEmergency" readonly>
    </div>
    <div class="detail-row">
      <i class="fa fa-id-badge icon-id"></i>
      <input type="text" id="empID" readonly>
    </div>
    <div class="detail-row">
      <i class="fa fa-tint icon-blood"></i>
      <input type="text" id="empBloodGroup" readonly>
    </div>
  </div>

  <!-- Update Button -->
  <button id="updateBtn">Update</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getDatabase, ref, get, update, child } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyATZi32dliIzjOCIXcv1MbxOXhkNjogA6Q",
  authDomain: "aventattendance.firebaseapp.com",
  databaseURL: "https://aventattendance-default-rtdb.firebaseio.com/",
  projectId: "aventattendance",
  storageBucket: "aventattendance.appspot.com",
  messagingSenderId: "993022737242",
  appId: "1:993022737242:web:92c380107f73eb70ac1163"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let currentUserId = null;

onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }
  currentUserId = user.uid;
  loadProfile();
});

function loadProfile() {
  const dbRef = ref(db);
  get(child(dbRef, `users/${currentUserId}`))
    .then((snapshot) => {
      if (snapshot.exists()) {
        const data = snapshot.val();
        document.getElementById("empName").value = data.name || "";
        document.getElementById("empDesignation").value = data.designation || "";
        document.getElementById("empDOB").value = data.dob || "";
        document.getElementById("empAddress").value = data.address || "";
        document.getElementById("empEmergency").value = data.emergencyContact || "";
        document.getElementById("empID").value = data.employeeId || "";
        document.getElementById("empBloodGroup").value = data.bloodGroup || "";
        document.getElementById("empNameDisplay").textContent = data.name || "—";
        document.getElementById("empDesignationDisplay").textContent = data.designation || "—";
        if (data.profilePic) {
          document.getElementById("profilePic").src = data.profilePic;
        }
      } else {
        alert("Profile data not found.");
      }
    })
    .catch((error) => {
      console.error("Error fetching profile:", error);
    });
}

document.getElementById("updateBtn").addEventListener("click", () => {
  const isReadOnly = document.getElementById("empName").readOnly;

  if (isReadOnly) {
    document.querySelectorAll(".details-card input").forEach(input => input.readOnly = false);
    document.getElementById("updateBtn").textContent = "Save";
    document.getElementById("updateBtn").style.background = "linear-gradient(90deg, #28a745, #218838)";
  } else {
    const updatedData = {
      name: document.getElementById("empName").value,
      designation: document.getElementById("empDesignation").value,
      dob: document.getElementById("empDOB").value,
      address: document.getElementById("empAddress").value,
      emergencyContact: document.getElementById("empEmergency").value,
      employeeId: document.getElementById("empID").value,
      bloodGroup: document.getElementById("empBloodGroup").value
    };
    update(ref(db, `users/${currentUserId}`), updatedData)
      .then(() => {
        alert("Profile updated successfully!");
        document.querySelectorAll(".details-card input").forEach(input => input.readOnly = true);
        document.getElementById("updateBtn").textContent = "Update";
        document.getElementById("updateBtn").style.background = "linear-gradient(90deg, #007bff, #0056b3)";
        document.getElementById("empNameDisplay").textContent = updatedData.name;
        document.getElementById("empDesignationDisplay").textContent = updatedData.designation;
      })
      .catch((error) => {
        console.error("Error updating profile:", error);
      });
  }
});
</script>

<script src="js/footer.js"></script>

</body>
</html>