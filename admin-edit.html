<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HR Employee Management</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    .employee-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      border-bottom: 1px solid #ddd;
    }
    .btn-edit {
      background: #007BFF;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    .btn-edit i {
      margin-right: 4px;
    }
    .btn-edit:hover {
      background: #0056b3;
    }
    .card {
      max-width: 900px;
      margin: auto;
      margin-top: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 20px;
    }
    .card h2 {
      margin-bottom: 16px;
    }
    form label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    form input, form select, form textarea {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    form button {
      margin-top: 16px;
      background: #28a745;
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: 4px;
      cursor: pointer;
    }
    form button:hover {
      background: #1e7e34;
    }
  </style>
</head>
<body>

  <header class="app-header">
    <div class="header-title"><i class="fas fa-users-cog"></i> HR Employee Management</div>
  </header>

  <div class="card">
    <h2><i class="fas fa-users"></i> Employee List</h2>
    <div id="employeeList"></div>
  </div>

  <div class="card" id="editCard" style="display:none;">
    <h2><i class="fas fa-user-edit"></i> Edit Profile</h2>
    <form id="editForm">
      <h3>Basic Info</h3>
      <label>Full Name</label>
      <input type="text" id="fullName">
      <label>Profile Photo URL</label>
      <input type="text" id="profilePhoto">
      <label>Date of Birth</label>
      <input type="date" id="dob">
      <label>Gender</label>
      <select id="gender">
        <option value="">Select</option>
        <option>Male</option>
        <option>Female</option>
        <option>Other</option>
      </select>
      <label>Marital Status</label>
      <select id="maritalStatus">
        <option value="">Select</option>
        <option>Single</option>
        <option>Married</option>
      </select>
      <label>Blood Group</label>
      <input type="text" id="bloodGroup">

      <h3>Contact Info</h3>
      <label>Personal Email</label>
      <input type="email" id="personalEmail">
      <label>Work Email</label>
      <input type="email" id="workEmail">
      <label>Mobile</label>
      <input type="text" id="mobile">
      <label>Alternate Mobile</label>
      <input type="text" id="alternateMobile">
      <label>Current Address</label>
      <textarea id="currentAddress"></textarea>
      <label>Permanent Address</label>
      <textarea id="permanentAddress"></textarea>

      <h3>Employment Details</h3>
      <label>Employee ID</label>
      <input type="text" id="employeeId">
      <label>Designation</label>
      <input type="text" id="designation">
      <label>Department</label>
      <input type="text" id="department">
      <label>Date of Joining</label>
      <input type="date" id="dateOfJoining">
      <label>Employment Type</label>
      <select id="employmentType">
        <option value="">Select</option>
        <option>Full-time</option>
        <option>Part-time</option>
        <option>Contract</option>
      </select>
      <label>Reporting Manager</label>
      <input type="text" id="reportingManager">
      <label>Office Location</label>
      <input type="text" id="officeLocation">

      <h3>Emergency Info</h3>
      <label>Contact Name</label>
      <input type="text" id="emergencyContactName">
      <label>Contact Number</label>
      <input type="text" id="emergencyContactNumber">
      <label>Relation</label>
      <input type="text" id="emergencyRelation">

      <button type="submit"><i class="fas fa-save"></i> Save Changes</button>
    </form>
  </div>

  <script type="module">
    import { db } from './firebase-config.js';
    import { ref, get, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    const employeeList = document.getElementById('employeeList');
    const editCard = document.getElementById('editCard');
    const editForm = document.getElementById('editForm');
    let selectedUserId = null;

    async function loadEmployees() {
      employeeList.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Loading...`;
      const snapshot = await get(ref(db, 'users'));
      employeeList.innerHTML = '';
      if (snapshot.exists()) {
        Object.entries(snapshot.val()).forEach(([uid, data]) => {
          const name = data.basicInfo?.fullName || "Not Available";
          const empId = data.employmentDetails?.employeeId || "N/A";
          const designation = data.employmentDetails?.designation || "Not Available";

          const row = document.createElement('div');
          row.className = "employee-row";
          row.innerHTML = `
            <div>
              <strong>${name}</strong> <small>(${empId})</small><br>
              <span>${designation}</span>
            </div>
            <button class="btn-edit" data-uid="${uid}">
              <i class="fas fa-edit"></i> Edit
            </button>
          `;
          employeeList.appendChild(row);
        });
        document.querySelectorAll('.btn-edit').forEach(btn => {
          btn.addEventListener('click', async () => {
            const uid = btn.getAttribute('data-uid');
            const userSnapshot = await get(ref(db, `users/${uid}`));
            if (userSnapshot.exists()) {
              loadUser(uid, userSnapshot.val());
            }
          });
        });
      } else {
        employeeList.innerHTML = `<p>No employees found.</p>`;
      }
    }

    function loadUser(uid, data) {
      selectedUserId = uid;
      editCard.style.display = 'block';
      document.getElementById('fullName').value = data.basicInfo?.fullName || '';
      document.getElementById('profilePhoto').value = data.basicInfo?.profilePhoto || '';
      document.getElementById('dob').value = data.basicInfo?.dob || '';
      document.getElementById('gender').value = data.basicInfo?.gender || '';
      document.getElementById('maritalStatus').value = data.basicInfo?.maritalStatus || '';
      document.getElementById('bloodGroup').value = data.basicInfo?.bloodGroup || '';
      document.getElementById('personalEmail').value = data.contactInfo?.personalEmail || '';
      document.getElementById('workEmail').value = data.contactInfo?.workEmail || '';
      document.getElementById('mobile').value = data.contactInfo?.mobile || '';
      document.getElementById('alternateMobile').value = data.contactInfo?.alternateMobile || '';
      document.getElementById('currentAddress').value = data.contactInfo?.currentAddress || '';
      document.getElementById('permanentAddress').value = data.contactInfo?.permanentAddress || '';
      document.getElementById('employeeId').value = data.employmentDetails?.employeeId || '';
      document.getElementById('designation').value = data.employmentDetails?.designation || '';
      document.getElementById('department').value = data.employmentDetails?.department || '';
      document.getElementById('dateOfJoining').value = data.employmentDetails?.dateOfJoining || '';
      document.getElementById('employmentType').value = data.employmentDetails?.employmentType || '';
      document.getElementById('reportingManager').value = data.employmentDetails?.reportingManager || '';
      document.getElementById('officeLocation').value = data.employmentDetails?.officeLocation || '';
      document.getElementById('emergencyContactName').value = data.emergencyInfo?.contactName || '';
      document.getElementById('emergencyContactNumber').value = data.emergencyInfo?.contactNumber || '';
      document.getElementById('emergencyRelation').value = data.emergencyInfo?.relation || '';
    }

    editForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!selectedUserId) return;
      const updatedData = {
        basicInfo: {
          fullName: document.getElementById('fullName').value,
          profilePhoto: document.getElementById('profilePhoto').value,
          dob: document.getElementById('dob').value,
          gender: document.getElementById('gender').value,
          maritalStatus: document.getElementById('maritalStatus').value,
          bloodGroup: document.getElementById('bloodGroup').value
        },
        contactInfo: {
          personalEmail: document.getElementById('personalEmail').value,
          workEmail: document.getElementById('workEmail').value,
          mobile: document.getElementById('mobile').value,
          alternateMobile: document.getElementById('alternateMobile').value,
          currentAddress: document.getElementById('currentAddress').value,
          permanentAddress: document.getElementById('permanentAddress').value
        },
        employmentDetails: {
          employeeId: document.getElementById('employeeId').value,
          designation: document.getElementById('designation').value,
          department: document.getElementById('department').value,
          dateOfJoining: document.getElementById('dateOfJoining').value,
          employmentType: document.getElementById('employmentType').value,
          reportingManager: document.getElementById('reportingManager').value,
          officeLocation: document.getElementById('officeLocation').value
        },
        emergencyInfo: {
          contactName: document.getElementById('emergencyContactName').value,
          contactNumber: document.getElementById('emergencyContactNumber').value,
          relation: document.getElementById('emergencyRelation').value
        }
      };
      await update(ref(db, 'users/' + selectedUserId), updatedData);
      alert('Profile updated successfully!');
      loadEmployees();
    });

    loadEmployees();
  </script>
</body>
</html>